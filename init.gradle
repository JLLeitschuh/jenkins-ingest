initscript {
    repositories {
        gradlePluginPortal()
    }
    dependencies {
        classpath("io.moderne:moderne-gradle-plugin:latest.release")
    }
}

/**
    Please update this file in source control with changes made here.
    https://github.com/moderneinc/jenkins-ingest/blob/main/init.gradle
 */ 
allprojects {
    project.afterEvaluate {
        if (!project.plugins.hasPlugin(io.moderne.gradle.ModernePlugin)) {
            project.plugins.apply(io.moderne.gradle.ModernePlugin)

         	if (!project.plugins.hasPlugin('maven-publish')) {
          		project.plugins.apply('maven-publish')
         	}

          
            project.publishing {
                publishing {
                    publications {
                        create("moderne", MavenPublication.class) {
                            artifact(tasks.named("moderneJar"))
                        }
                    }
                }
                repositories {
                    maven {
                        url = 'https://artifactory.moderne.ninja/artifactory/moderne-public-ast/'
                        allowInsecureProtocol(true)
                        credentials {
                            username = System.getenv("ARTIFACTORY_USER")
                            password = System.getenv("ARTIFACTORY_PASSWORD")
                        }
                    }
                }
            }
        }
    }
}